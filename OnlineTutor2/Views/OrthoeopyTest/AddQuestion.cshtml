@model OnlineTutor2.Models.OrthoeopyQuestion
@{
    ViewData["Title"] = "Добавить вопрос по орфоэпии";
    var test = ViewBag.Test as OnlineTutor2.Models.OrthoeopyTest;
    var nextOrderIndex = ViewBag.NextOrderIndex;
}

<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="fas fa-plus"></i> Добавить вопрос по орфоэпии
                </h4>
            </div>
            <div class="card-body">

                <form asp-action="AddQuestion" method="post">

                    <input asp-for="OrthoeopyTestId" type="hidden" />
                    <input asp-for="OrderIndex" type="hidden" />

                    <div asp-validation-summary="All" class="text-danger mb-3"></div>

                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle"></i> Добавление вопроса в тест:</h6>
                        <strong>@test.Title</strong>
                        <br><small class="text-muted">Вопрос №@nextOrderIndex</small>
                    </div>

                    <fieldset class="mb-4">
                        <legend class="fs-6 text-success border-bottom pb-1 mb-3">
                            <i class="fas fa-volume-up"></i> Информация о вопросе
                        </legend>

                        <div class="mb-3">
                            <label asp-for="Word" class="form-label">
                                <i class="fas fa-font"></i> Слово <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Word" class="form-control" placeholder="Например: договор" />
                            <span asp-validation-for="Word" class="text-danger"></span>
                            <div class="form-text">
                                <i class="fas fa-lightbulb"></i> Введите слово без ударения
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="StressPosition" class="form-label">
                                    <i class="fas fa-sort-numeric-down"></i> Позиция ударения (номер слога) <span class="text-danger">*</span>
                                </label>
                                <input asp-for="StressPosition" class="form-control" type="number" min="1" max="20" />
                                <span asp-validation-for="StressPosition" class="text-danger"></span>
                                <div class="form-text">
                                    <i class="fas fa-info-circle"></i> Номер слога с ударением (1, 2, 3...)
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="WordWithStress" class="form-label">
                                    <i class="fas fa-check"></i> Слово с ударением <span class="text-danger">*</span>
                                </label>
                                <input asp-for="WordWithStress" class="form-control" placeholder="догов́ор" />
                                <span asp-validation-for="WordWithStress" class="text-danger"></span>
                                <div class="form-text">
                                    <i class="fas fa-lightbulb"></i> Символ ударения: ́ (скопируйте)
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Points" class="form-label">
                                <i class="fas fa-trophy"></i> Баллы за правильный ответ
                            </label>
                            <input asp-for="Points" class="form-control" type="number" min="1" max="10" />
                            <span asp-validation-for="Points" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Hint" class="form-label">
                                <i class="fas fa-question-circle"></i> Подсказка (необязательно)
                            </label>
                            <textarea asp-for="Hint" class="form-control" rows="4"
                                      placeholder="Объяснение правила ударения..."></textarea>
                            <span asp-validation-for="Hint" class="text-danger"></span>
                            <div class="form-text">
                                <i class="fas fa-lightbulb"></i> Подсказка поможет ученикам понять правило ударения
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="mb-4">
                        <legend class="fs-6 text-primary border-bottom pb-1 mb-3">
                            <i class="fas fa-eye"></i> Предварительный просмотр
                        </legend>

                        <div class="card bg-light">
                            <div class="card-body">
                                <h6>Как будет выглядеть вопрос для ученика:</h6>
                                <div class="question-preview mt-3 p-3 bg-white rounded border">
                                    <p class="mb-2">
                                        <strong>Вопрос №@nextOrderIndex:</strong>
                                    </p>
                                    <p class="mb-3">
                                        Выберите правильное ударение в слове:
                                    </p>
                                    <div class="mb-3 p-3 bg-light rounded text-center">
                                        <span class="h4" id="preview-word">договор</span>
                                    </div>
                                    <div class="word-options mb-3">
                                        <div class="btn-group-vertical w-100" role="group">
                                            <button type="button" class="btn btn-outline-primary text-start" disabled>
                                                <span class="h6">дóговор</span>
                                            </button>
                                            <button type="button" class="btn btn-outline-primary text-start" disabled>
                                                <span class="h6">договóр</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div id="preview-hint" class="alert alert-info small" style="display: none;">
                                        <i class="fas fa-lightbulb"></i> <strong>Подсказка:</strong>
                                        <span id="hint-text">Здесь будет подсказка</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a asp-action="Details" asp-route-id="@test.Id" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left"></i> Отмена
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Добавить вопрос
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const wordInput = document.getElementById('Word');
            const hintInput = document.getElementById('Hint');
            const previewWord = document.getElementById('preview-word');
            const previewHint = document.getElementById('preview-hint');
            const hintText = document.getElementById('hint-text');

            function updatePreviewWord() {
                const word = wordInput.value.trim();
                if (word) {
                    previewWord.textContent = word;
                } else {
                    previewWord.textContent = 'договор';
                }
            }

            function updatePreviewHint() {
                const hint = hintInput.value.trim();
                if (hint) {
                    hintText.textContent = hint;
                    previewHint.style.display = 'block';
                } else {
                    previewHint.style.display = 'none';
                }
            }

            wordInput.addEventListener('input', updatePreviewWord);
            hintInput.addEventListener('input', updatePreviewHint);

            updatePreviewWord();
            updatePreviewHint();
        });
    </script>
}
