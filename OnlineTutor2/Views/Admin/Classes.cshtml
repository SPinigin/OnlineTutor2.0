@model List<OnlineTutor2.Models.Class>
@{
    ViewData["Title"] = "Управление классами";
}

@await Html.PartialAsync("_AdminNav")

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2><i class="fas fa-graduation-cap text-primary"></i> Управление классами</h2>
        <p class="text-muted">
            Всего классов: <strong>@Model.Count</strong> |
            Учеников: <strong>@Model.Sum(c => c.Students.Count)</strong>
        </p>
    </div>
    <div>
        <div class="btn-group">
            <button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown">
                <i class="fas fa-file-export"></i> Экспорт
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a class="dropdown-item" asp-action="ExportClasses" asp-route-format="excel">
                        <i class="fas fa-file-excel text-success"></i> Excel
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" asp-action="ExportClasses" asp-route-format="csv">
                        <i class="fas fa-file-csv text-success"></i> CSV
                    </a>
                </li>
            </ul>
        </div>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> К дашборду
        </a>
    </div>
</div>


<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center border-primary">
            <div class="card-body">
                <i class="fas fa-graduation-cap text-primary" style="font-size: 2rem;"></i>
                <h3 class="mt-2">@Model.Count</h3>
                <p class="text-muted mb-0">Всего классов</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center border-info">
            <div class="card-body">
                <i class="fas fa-user-graduate text-info" style="font-size: 2rem;"></i>
                <h3 class="mt-2">@Model.Sum(c => c.Students.Count)</h3>
                <p class="text-muted mb-0">Учеников</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center border-success">
            <div class="card-body">
                <i class="fas fa-tasks text-success" style="font-size: 2rem;"></i>
                <h3 class="mt-2">@(Model.Sum(c => c.RegularTests.Count + c.SpellingTests.Count + c.PunctuationTests.Count + c.OrthoeopyTests.Count))</h3>
                <p class="text-muted mb-0">Тестов</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center border-warning">
            <div class="card-body">
                <i class="fas fa-file-alt text-warning" style="font-size: 2rem;"></i>
                <h3 class="mt-2">@Model.Sum(c => c.Materials.Count)</h3>
                <p class="text-muted mb-0">Материалов</p>
            </div>
        </div>
    </div>
</div>


<div class="row">
    @foreach (var classItem in Model)
    {
        var totalTests = classItem.RegularTests.Count + classItem.SpellingTests.Count +
        classItem.PunctuationTests.Count + classItem.OrthoeopyTests.Count;

        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-graduation-cap"></i> @classItem.Name
                        </h5>
                        <span class="badge bg-light text-dark">
                            <i class="fas fa-users"></i> @classItem.Students.Count
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="text-muted small">Учитель</label>
                        <div>
                            <i class="fas fa-chalkboard-teacher text-success"></i>
                            <strong>@classItem.Teacher.FullName</strong>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(classItem.Description))
                    {
                        <div class="mb-3">
                            <label class="text-muted small">Описание</label>
                            <p class="small mb-0">@classItem.Description</p>
                        </div>
                    }


                    <div class="row g-2 mt-3">
                        <div class="col-6">
                            <div class="card bg-light text-center">
                                <div class="card-body p-2">
                                    <i class="fas fa-spell-check text-primary"></i>
                                    <h6 class="mb-0">@classItem.SpellingTests.Count</h6>
                                    <small class="text-muted">Орфография</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-center">
                                <div class="card-body p-2">
                                    <i class="fas fa-list-ul text-success"></i>
                                    <h6 class="mb-0">@classItem.RegularTests.Count</h6>
                                    <small class="text-muted">Классические</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-center">
                                <div class="card-body p-2">
                                    <i class="fas fa-quote-right text-danger"></i>
                                    <h6 class="mb-0">@classItem.PunctuationTests.Count</h6>
                                    <small class="text-muted">Пунктуация</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-center">
                                <div class="card-body p-2">
                                    <i class="fas fa-volume-up text-warning"></i>
                                    <h6 class="mb-0">@classItem.OrthoeopyTests.Count</h6>
                                    <small class="text-muted">Орфоэпия</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <i class="fas fa-file-alt"></i>
                                Материалов: @classItem.Materials.Count
                            </small>
                            <small class="text-muted">
                                <i class="fas fa-calendar"></i>
                                @classItem.CreatedAt.ToString("dd.MM.yyyy")
                            </small>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="d-flex justify-content-between align-items-center">
                        <a asp-controller="ClassManagement" asp-action="Details"
                           asp-route-id="@classItem.Id"
                           class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-eye"></i> Подробнее
                        </a>

                        <form asp-action="DeleteClass" asp-route-id="@classItem.Id"
                              method="post" class="d-inline"
                              onsubmit="return confirm('ВНИМАНИЕ! Удалить класс @classItem.Name?\n\nУченики: @classItem.Students.Count\nТесты: @totalTests\nМатериалы: @classItem.Materials.Count\n\nУченики и тесты не будут удалены, только отвязаны от класса.')">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-outline-danger btn-sm">
                                <i class="fas fa-trash-alt"></i> Удалить
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@if (!Model.Any())
{
    <div class="alert alert-info text-center">
        <i class="fas fa-info-circle fa-2x mb-3"></i>
        <h5>Классы не созданы</h5>
        <p class="text-muted">Учителя еще не создали ни одного класса</p>
    </div>
}

@section Scripts {
    <script src="~/js/layout.js" asp-append-version="true"></script>
}

@section Styles {
    <style>
        .card {
            transition: transform 0.2s;
        }

            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }
    </style>
}
